一、源起

从黑莓老ＯＳ开始，我就一直在使用自动图文集（autotext）五笔输入法，因为我是南方人，拼音不灵。后来到了OS6以后，这个功能更名为单词替换，其实都是一个意思。可惜的是到了ＢＢ１０系统上，这个功能被阄割得不成样子了，多次向黑莓公司反应也没有改善。现在最新版的BB10系统中，这个功能不完善，替换条数有限制，而且不能导入导出:<。那既然现在都用安卓了，何不自己开发一个输入法，实现全功能的“单词替换”功能呢？下定决心，从头学习Android开发，于是就有了这个软件。向老黑莓致敬，向三叶莓致敬！

二、初步原理

单词替换的原理非常简单，就是输入字母后，再输入空格就把光标到前面第一个空格之间的东西替换成别的东西。这“别的东西”当然是可以你自己设定的。黑莓开发这个功能只是为了自动纠错和简写，比如英文中常输入cant，再按空格后可自动更正成can't；输入mns，再输入空格的时候就自动替换成minutes，平淡无奇是不是？但是中国有牛人三叶莓，使用这个功能开发出神一般存在的中文输入法。其实中文输入法的本质也就是输入几个字母，然后替换成对应的中文字。

由于替换的词条可以自已定义，所以这种原理支持几乎所有的输入法编码，以最简单的拼音输入法为例(当然这种最原始的拼音输入法效率很低)，设置以下的词条条目：
wo　　我
ni　　你
这时如果在一个文本输入框中输入wo，然后再输入空格，则之前的wo就被自动替换成“我”。输入ni，再输入空格，则ni就被替换成“你”了。

既然可以把wo设置成“我”，当然也可以设置成别的，比如：
wo　　我在这里很好，你不用担心！
这时输入wo后，再输入空格，则wo就被替换成了“我在这里很好，你不用担心！”，是不是很方便呢？这只是小菜一碟啦，后面还有更厉害的。

再假设我们设置的替换条目如下：
wo　　我
ai　　爱
ni　　你
要输入中文“我爱你”，自然就会想到输入"wo空格ai空格ni空格“，但是很不幸最后的结果不是"我爱你"，而是“我　爱　你　”——每个字后面都有一个空格，这当然不行。我们需要在每次替换的时候，先往前删除一个空格，这正好就是％b宏的功能。所以应该这么设置：
wo　　%b我
ai　　%b爱
ni　　%b你
这时就可以如愿地说“我爱你”了。还没完，下面还有更更厉害的，往下看！

三、宏命令

宏命令那么好用，当然不会只有一个，其实有七个（还可以加！）：
%b :往前删除一个字符
%B :往后删除一个字符
%d :显示日期，格式 2015-10-21 
%t :显示时间，格式 07:08
%D :显示长日期，带时间，效果相当于 “%d %t”
%w :删除刚刚替换上去的内容，也可以删除输入的错码
%p :显示%本身
%c :显示逗号（,）
其中最最重要的是%b和%B，%b前面已经说到了妙用在于删除前面的空格，%B的妙用在何处呢？你能猜到吗？系统自带的词库中还有如下的条目，想想都实现什么功能呢？
$,%b
$$,%b%b
$$$,%b%b%b
$$$$,%b%b%b%b
$ld,%d
$ldd,%D
$lt,%t
0$,%w

四、重码的选择

拼音中wo可以代表“我”，当然也可以代表“喔”，也就是重码，怎么办呢？这一点，我不得不佩服中国的神人三叶莓啊！他的天才思路是这么解决的：
wo　　1我2喔%B
1我2喔a　　%b
1我2喔　　%b我
1我2喔e　　%b喔
来详细看一下选字的过程：
输入wo再按空格，则得到“1我2喔”，注意这时“喔”后面是没有空格的，这个空格被宏“%B”删掉了，这就是%B的妙用！再输入一个空格，按照上面的替换条目，“1我2喔”将被替换成“我”。同样的如果输入“e”（黑莓键盘上的数字2对应的字母）再按空格，则可得到“喔”，这样就完美地解决重码选字问题，是不是天才的思路？！更进一步地，如果输入“a”，则取消当前的输入，重新来！如果重码超过了9个，还可以翻页，只要不断按空格就可以了，不过这时选第一个备选项的时候要输入“w”了，想想为什么呢？（因为空格已经用来翻页了，就不能再用来选字了）

五、英文输入

当然有时候就是想输入英文，那也没有关系，因为还有反向替换功能。假设替换条目如下：
wo　　%b我
这时想输入英文字母“wo”表示感叹，先输入“wo”再按空格。按照替换规则，“wo”被替换成了“我”，没关系，再按一下删除键，这时并不是删除一个字而是触发反向替换，“我”又变成了“wo”，这时再按空格就不会再触发替换了，从而可以实现中英文的无缝输入，完全不用切换哦。我不得不感叹当初设计单词替换功能的设计师考虑周到！相比之下，黑莓10系统中的单词替换功能就是渣！当然，还有另外一种方法，就是长按一个键，这个字母就会自动变成大写的，这时再往后输入其他字母再按空格也不会触发替换了。也就是说这个输入法是大小写敏感的！

当然这种方式只适合少量的英文输入，如果要大段输入英文，每次都这么操作，很烦人，解决办法也很简单，你想到了吗？（答案看最后！）

使用这种原理进行中文输入，有三大优点：
１、替换条目是自设的，可以非常灵活，可同时支持多种编码，完全支持自创编码。比如可以把自己的地址设成一个条目，按几个字母加空格就可以输入地址。
２、这种机制支持宏，比如可设置“%d”代表当前日期等。
３、我最看重的好处就是：可以实现中英文无缝输入。配合快捷键，手指不用离开键盘，眼睛不用在输入法和输入框中间换来换去，实现如飞般的输入体验。
4、本输入法较适合于五笔这种重码率较低的编码。拼音这种重码率高的编码，在商业输入法中一般采用智能记忆，动态调整备选秩序，云更新词库等手段来提高命中率，这些手段开发复杂，本输入法没有。所以这个输入法中自带的“五笔拼音”这个词库中，拼音都只是单字，用来在五笔实在打不出来的时候应急的，就像电脑里一般都会安装一个全拼输入法一样，它的字比较全。拼音的编码都是在拼音后面加上一个“$”组成的，比如“果”的编码是"guo$"。

六、符号的输入

有了替换，符号输入不是问题，只要设好替换条目就是了。在软件自带的五笔加拼音编码中，符号的定义是：
$开头符号
$pp,　　（两个全角空格）
$q,#
$w,1
$e,2
$r,3
$t,(
$y,)
$u,_
$i,-
$o,+
$p,@
$a,*
$s,4
$d,5
$f,6
$g,/
$h,:
$j,;
$k,'
$l,"
$z,7
$x,8
$c,9
$v,?
$b,!
$n,%c
$m,.
$0,0

z字开头符号
zq,《
zw,》
ze,`
zr,^
zt,（
zy,）
zu,——
zi,……
zo,、
zp,·
za,<
zs,>
zd,“
zf,‘
zg,\
zh,：
zj,；
zk,’
zl,”
zz,[
zx,]
zc,&
zv,？
zb,！
zn,，
zm,。
z$,%
z0,0

符号看起来很多，不好记，其实是有规律的。z加上对应的字母，就是对应的中文符号。比如：
zm　　。
z加上两个对应的字母，就是对应的英文符号或数字。比如：
zmm　　.
剩下的几个，只好记一记了！最后一个条目是生僻符号集合，“zfh”表示“字符号”，有好多奇奇怪怪的符号！（用到了twolevel功能！！！）

七、快捷键

黑莓的输入法，怎么能没有快捷键呢？Autotext输入法设置了很多快捷键，支持的快捷键如下（左shift键当作ctrl键来用）：
//经典的windows快捷键
C-c　复制
C-v　粘贴
C-x　剪切
C-z UNDO
//选择系的快捷键，认真核对黑莓键盘上的位置，你会有新发现的。
C-s 进入选择模式，或者退出选择模式
C-a　全选
C-f 选行
在选择模式下，注意这里的行是指以换行符（\n）分隔的行，不是自动折叠出来的行：
	a 全选
	f 选行
	h 往前选一个字符
	j 往下选一行
	k 往上选一行
	l 往后选一个字符
	u 选到行头
	o 选到行尾
	y 选到头
	p 选到尾
//移动系的快捷键，可大大提高编辑效率
C-h 往前
C-j 往下
C-k 往上
C-l 往后
C-u 到行头
C-o 到行尾
C-y 到头
C-p 到尾
//删除系的快捷键，嗯？怎么没有往前删除一个字符的快捷键呢？你说呢！
C-d　删除所有内容
C-b　删到最开头
C-m　删行
//切换词库
C-enter

八、源文件及twolevel
词库的源文件的格式非常简单，原则如下：
1、每一行为一个编码及候选词项，中间用英文的逗号分隔。第一个即为编码，后面的都是候选词。比如：
	ukjg,问题,总量
	q,我
	ynky,赢,羸,蠃,嬴
	lai$,来,莱,赖,涞........
2、编码不能重复，如果在源文件中有重复编码，以最后一个为准。
3、英文的逗号和百分号要分别转义成 %c 和 %p
4、[twolevel]和[/twolevel]用于标记“二级编码”。比如自带词库中 zfh 的条目就使用了“二级编码”：

[twolevel]
zfh,符号,编号,数学,单位,货币,箭头,拼音
符号,|,{,},.,;,',[,],\,=,-,`,<,>,:,",_,+,),(,*,&,^,%,$,#,@,!,~
编号,■,◆,●,○,★,☆,⒈,⒉,⒊,⒋,⒌,⒍,⒎,⒏,⒐,⒑,⒒,⒓,⒔,⒕,⒖,⒗,⒘,⒙,⒚,⒛,Ⅰ,Ⅱ,Ⅲ,Ⅳ,Ⅴ,Ⅵ,Ⅶ,Ⅷ,Ⅸ,Ⅹ,Ⅺ,Ⅻ
数学,﹢,﹣,×,÷,π,∫,≌,∽,≤,≥,≦,≧,≈,≠∷,∶,∵,∴,∮,∝,∞,∧,∨,∑,∏,∪,∩,∈,⊥,∥,∠,⌒,⊙,√,∟,⊿,㏒,㏑,‰,ø,Ø,½,⅓,⅛,⅔,⅜,¾,⅝,⅞
单位,℃,℉,°,′,″,〒,￠,￡,＠,㎡,m³,㎎,㎏,㎜,㎝,㎞,㏄
货币,€,£,Ұ,₳,₲,₡
箭头,↑,↓,←,→,↖,↗,↘,↙,↔,↕
拼音,ā,á,ǎ,à,ō,ó,ǒ,ò,ē,é,ě,è,ī,í,ǐ,ì,ū,ú,ǔ,ù,ǖ,ǘ,ǚ,ǜ,ü
[/twolevel]
	
5、"二级编码"的第一行为第一级，下面的为第二级。第二级的编码要与第一级中的候选项一一对应。
6、在软件词库条目管理界面输入“twolevel”可以查看修改本词库的所有二级编码的内容，不同组的“二级编码”由相应条目前的数字来区分。
7、要新建一个二级编码只能使用“导入”功能。

九、emoji输入
从4.2版本起，本软件增加了emoji输入功能，sym键-启用/往后翻页，0键-往前翻页，$键-关闭，sym+字母键-输入对应的表情。emoji表情有点坑爹，国际标准组织只规定了表情的内容及对应的编码，图形是什么样的，各系统或软件可自行绘制，所以同样是一个“大笑”的表情，安卓的和IOS的外观可能完全不一样（据说安卓8.0起，要与IOS的表情看齐了！）。注意：本软件输入的是安卓系统自带的emoji表情，可能与微信的不一样，不过在微信中使用表情时，会被自动替换成微信的版本的emoji。

十、其他
有个小技巧，五笔中没有以z开头的编码，所以在使用五笔编码时可以用来自定义，而不用担心与五笔编码重码。此外，黑莓键盘上还有一个$键，也可以用来自定义编码。软件自带词库中，输入拼音最后再加上$，即表示是拼音编码，有时候真的忘了一个字五笔怎么打，可以用来救急。拼音的重码很多，可以直接按空格翻页，按0加空格往回翻页。

再来回答上面提出的全英文输入的问题。答案就是：只要建一个空字库就可以了。因为没有字库，所有输入都不会发生替换，也就是全英文输入了。当然，为了方便，我们还是可以设置符号、日期、某些自动更正的替换！比如：
$lt	%t
cant	can't
看到了吗？这里设置的替换条目没有加上%b和%B的宏命令，相信通篇看完这篇文章的人已经有答案了，因为英文单词的前后本来就需要空格的。

十一、联系方式
EMAIL：queshw@outlook.com

十二、全键盘输入支持（因为是新加的功能，所以列在这里了）
首先来说明中文标点符号输入的规则：第一、键盘上对应的符号键，输入后按空格即为对应的中文标点，比如输入"."再加上空格，即可获得中文句号“。”。对应的规则与一般输入法相同。
第二、一个键上有两个符号的，比如“;”号键，输入“;”加空格，获得中文“；”。输入“z;”再加空格，获得中文“；”。具体的编码如下：
%c,，
.,。
/,、
;,；
',‘,’
[,【
],】
\,、
`,·
-,-
=,=
z%c,《
z.,》
z/,？
z;,：
z',“,”
z[,{
z],}
z\,|
z`,~
z1,！
z2,@
z3,#
z4,￥
z5,%
z6,……
z7,&
z8,*
z9,（
z0,）
z-,——
z=,+